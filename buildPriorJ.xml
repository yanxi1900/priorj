<?xml version="1.0" encoding="UTF-8"?>
<project basedir="." default="main" name="PriorJAplicacao">
	<property name="pathApp" value=""/>
	<property name="pathCode" value=""/>
	<property name="pathTest" value=""/>
	<property name="pathLib" value=""/>
	<property name="pathData" value=""/>
	
	<property name="src" 		 value="${pathApp}/${pathCode}"/>
	<property name="tests" 		 value="${pathApp}/${pathTest}"/>
	<property name="build" 		 value="${pathApp}/build"/>
	<property name="classes.dir" value="${build}/"/>
	<property name="lib.dir"     value="${pathApp}/${pathLib}"/>
	<property name="data.dir" 	 value="${pathApp}/${pathData}"/>
	<property name="report"      value="report"/>
	<property name="workspace"   value="workspace" />
	<property name="order" 	     value="report/order"/>
	<property name="suites"	     value="report/suites"/>
	<property name="jar.dir"     value="${pathApp}/dist"/>
	<property name="main-class"  value=""/>
	

	<path id="master-classpath">
	    <pathelement path="${build}"/>
	</path> 
	
	<path id="classpath">
		<fileset dir="${lib.dir}" includes="**/*.jar"/>
	</path>
	
	<!-- Define the classpath which includes the tests resources -->
	<path id="data.resources.path">
		<fileset dir="${data.dir}" />
	</path>
		
	<path id="application" location="${jar.dir}/${ant.project.name}.jar"/>

	<taskdef resource="org/aspectj/tools/ant/taskdefs/aspectjTaskdefs.properties">
		<classpath>
			<pathelement location="lib/aspectjtools.jar"/>
		</classpath>
	</taskdef>
	
	<target name="clean">
		<delete dir="${build}"/>
		<delete dir="${report}"/>
		<delete dir="${order}"/>
		<delete dir="${suites}"/>
		<!-- <delete dir="${workspace}" /> -->
	</target>
	
	<target name="compile">
		<mkdir dir="${build}"/>
		<mkdir dir="${report}"/>
		<mkdir dir="${order}"/>
		<mkdir dir="${suites}"/>
		<!-- <mkdir dir="${workspace}"/> -->

		<iajc destdir="${build}" sourceroots="${pathApp}" classpathref="classpath" source="1.6">
			<include name="**/*.java"/>
			<classpath>
				<pathelement location="lib/aspectjrt.jar"/>
			</classpath>
			<classpath refid="data.resources.path" />
		</iajc>
		<!--
		<copy todir="${build}" >
	      <fileset dir="${tests}" includes="**/*.properties" />
	      <fileset dir="${tests}" includes="**/*.xml" />
	      <fileset dir="${tests}" includes="**/*.zip" /> 
	    </copy>
		-->
	</target>
	
	<target name="jar" depends="compile">
			<mkdir dir="${jar.dir}"/>
			<jar destfile="${jar.dir}/${ant.project.name}.jar" basedir="${classes.dir}">
				<manifest>
					<attribute name="Main-Class" value="${main-class}"/>
				</manifest>
			</jar>
	</target>
	
	<target name="junit" depends="jar">
		<junit  printsummary="yes" haltonfailure="false" fork="yes">
	        <classpath >
	            <path refid="classpath"/>
	            <path refid="application"/>
	        	<path refid="data.resources.path"/>
	        </classpath>
	        	
	        <batchtest fork="yes" todir="${report}">
	            <fileset dir="${build}">
					<include name="**/*Test.class"/>
					
	                <exclude name="**/*All*.class"/>
	                <exclude name="**/*Suite*.class"/>
	               	<exclude name="**/*Abstract*.class"/>
	            </fileset>
	        </batchtest>
	        <formatter type="plain" usefile="false"/>
			<formatter type="xml"/> 

	    </junit>
			
		<junitreport todir="./report">
			<fileset dir="./report">
				<include name="TEST-*.xml"/>
			</fileset>
			<report format="noframes" todir="./report/html"/>
		</junitreport>
		
	</target>
	
	<target name="main" depends="clean, junit"/>

</project>
